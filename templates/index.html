<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADIC LogAssist AI | Intelligent Log Analytics</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="grid-overlay"></div>
        <div class="particles" id="particles"></div>
        <div class="glow-orbs">
            <div class="orb orb-1"></div>
            <div class="orb orb-2"></div>
            <div class="orb orb-3"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-icon">
                    <i class="fas fa-atom"></i>
                </div>
                <div class="logo-text">
                    <h1>ADIC LogAssist AI</h1>
                    <span class="tagline">From Natural Language to Insight in Seconds</span>
                </div>
            </div>
            <div class="header-status">
                <div class="status-indicator" id="connectionStatus">
                    <span class="pulse"></span>
                    <span class="status-text">INITIALIZING</span>
                </div>
                <div class="current-time" id="currentTime"></div>
            </div>
        </header>

        <!-- Main Content - New Layout -->
        <div class="content-wrapper">
            <!-- Top Section - Full Width Data Stream -->
            <section class="panel results-panel" id="resultsPanel">
                <div class="panel-header">
                    <div class="panel-title">
                        <i class="fas fa-database"></i>
                        <span>DATA STREAM</span>
                    </div>
                    <div class="panel-info">
                        <span class="row-count" id="rowCount">0 records</span>
                    </div>
                    <div class="panel-controls">
                        <button class="control-btn" id="scrollStartBtn" title="Scroll to Start">
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="control-btn" id="scrollEndBtn" title="Scroll to End">
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                        <button class="control-btn" id="showChartBtn" title="Show Chart">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="control-btn" id="exportCsvBtn" title="Export CSV">
                            <i class="fas fa-file-csv"></i>
                        </button>
                        <button class="control-btn" id="exportJsonBtn" title="Export JSON">
                            <i class="fas fa-file-code"></i>
                        </button>
                        <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                            <i class="fas fa-expand" id="fullscreenIcon"></i>
                        </button>
                    </div>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-satellite-dish"></i>
                        </div>
                        <h3>AWAITING DATA TRANSMISSION</h3>
                        <p>Enter a query below to begin analyzing your Azure logs</p>
                    </div>
                    
                    <div class="loading-state" id="loadingState" style="display: none;">
                        <div class="loader">
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                        </div>
                        <p>PROCESSING QUANTUM DATA...</p>
                    </div>

                    <!-- Chart Container -->
                    <div class="chart-container" id="chartContainer" style="display: none;">
                        <div class="chart-header">
                            <span class="chart-title">DATA VISUALIZATION</span>
                            <div class="chart-controls">
                                <select id="chartType" class="chart-select">
                                    <option value="bar">Bar Chart</option>
                                    <option value="line">Line Chart</option>
                                    <option value="pie">Pie Chart</option>
                                    <option value="doughnut">Doughnut</option>
                                </select>
                                <button class="control-btn" id="closeChartBtn" title="Close Chart">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="resultsChart"></canvas>
                    </div>

                    <!-- AI Insights Panel -->
                    <div class="ai-insights-container" id="aiInsightsContainer" style="display: none;">
                        <div class="ai-insights-header">
                            <div class="ai-insights-title">
                                <i class="fas fa-robot"></i>
                                <span>AI ANALYSIS</span>
                            </div>
                            <div class="ai-insights-controls">
                                <button class="control-btn" id="refreshInsightsBtn" title="Refresh Analysis">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="control-btn" id="closeInsightsBtn" title="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="ai-insights-content" id="aiInsightsContent">
                            <div class="ai-loading" id="aiInsightsLoading">
                                <i class="fas fa-brain fa-pulse"></i>
                                <span>Analyzing data...</span>
                            </div>
                            <div class="ai-insights-text" id="aiInsightsText"></div>
                        </div>
                    </div>

                    <div class="results-table-wrapper" id="resultsWrapper" style="display: none;">
                        <table class="results-table" id="resultsTable">
                            <thead id="tableHead"></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Bottom Section - Query & Data Sources -->
            <div class="bottom-panels">
                <!-- Query Panel -->
                <section class="panel query-panel" id="queryPanel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <i class="fas fa-terminal"></i>
                            <span>QUERY TERMINAL</span>
                        </div>
                        <div class="panel-controls">
                            <button class="control-btn" id="toggleQueryBtn" title="Minimize/Maximize">
                                <i class="fas fa-chevron-down" id="toggleQueryIcon"></i>
                            </button>
                            <button class="control-btn" id="clearBtn" title="Clear">
                                <i class="fas fa-eraser"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="query-content" id="queryContent">
                        <!-- Time Range Picker -->
                        <div class="time-range-picker" id="timeRangePicker">
                            <span class="label">
                                <i class="fas fa-clock"></i>
                                TIME RANGE
                            </span>
                            <div class="time-range-buttons">
                                <button class="time-btn" data-range="1h">1H</button>
                                <button class="time-btn" data-range="6h">6H</button>
                                <button class="time-btn active" data-range="24h">24H</button>
                                <button class="time-btn" data-range="7d">7D</button>
                                <button class="time-btn" data-range="30d">30D</button>
                                <button class="time-btn" id="customTimeBtn" title="Custom Range">
                                    <i class="fas fa-calendar-alt"></i>
                                </button>
                            </div>
                            <div class="custom-time-picker hidden" id="customTimePicker">
                                <input type="datetime-local" id="customTimeStart">
                                <span>to</span>
                                <input type="datetime-local" id="customTimeEnd">
                                <button class="apply-time-btn" id="applyCustomTime">Apply</button>
                            </div>
                        </div>

                        <div class="query-input-section">
                            <div class="input-wrapper">
                                <div class="input-glow"></div>
                                <textarea 
                                    id="queryInput" 
                                    placeholder="Enter your question in natural language or KQL query..."
                                    rows="3"
                                ></textarea>
                                <div class="input-decoration">
                                    <span class="corner top-left"></span>
                                    <span class="corner top-right"></span>
                                    <span class="corner bottom-left"></span>
                                    <span class="corner bottom-right"></span>
                                </div>
                            </div>
                            
                            <div class="query-actions">
                                <button class="action-btn primary" id="analyzeBtn">
                                    <i class="fas fa-brain"></i>
                                    <span>ANALYZE</span>
                                    <div class="btn-glow"></div>
                                </button>
                                <button class="action-btn secondary" id="kqlBtn">
                                    <i class="fas fa-code"></i>
                                    <span>RUN KQL</span>
                                </button>
                                <button class="action-btn tertiary" id="chatModeBtn" title="AI Chat Mode">
                                    <i class="fas fa-comments"></i>
                                    <span>CHAT</span>
                                </button>
                            </div>
                        </div>

                        <!-- Generated KQL Display -->
                        <div class="kql-display" id="kqlDisplay">
                            <div class="kql-header">
                                <i class="fas fa-code-branch"></i>
                                <span>GENERATED KQL</span>
                                <button class="copy-btn" id="copyKqlBtn" title="Copy KQL">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <pre class="kql-code" id="kqlCode"></pre>
                        </div>

                <!-- Query History & Favorites -->
                <div class="history-section" id="historySection">
                    <div class="history-tabs">
                        <button class="history-tab active" data-tab="history">
                            <i class="fas fa-history"></i> History
                        </button>
                        <button class="history-tab" data-tab="favorites">
                            <i class="fas fa-star"></i> Favorites
                        </button>
                    </div>
                    <div class="history-actions">
                        <button class="clear-history-btn" id="clearHistoryBtn" title="Clear History">
                            <i class="fas fa-trash-alt"></i> Clear
                        </button>
                    </div>
                    <div class="history-content" id="history-list">
                        <!-- Populated by JS -->
                    </div>
                    <div class="history-content hidden" id="favorites-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Center Panel - Results -->
            <section class="panel results-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <i class="fas fa-database"></i>
                        <span>DATA STREAM</span>
                    </div>
                    <div class="panel-info">
                        <span class="row-count" id="rowCount">0 records</span>
                    </div>
                    <div class="panel-controls">
                        <button class="control-btn" id="exportCsvBtn" title="Export CSV">
                            <i class="fas fa-file-csv"></i>
                        </button>
                        <button class="control-btn" id="exportJsonBtn" title="Export JSON">
                            <i class="fas fa-file-code"></i>
                        </button>
                        <button class="control-btn" id="exportPdfBtn" title="Export PDF">
                            <i class="fas fa-file-pdf"></i>
                        </button>
                        <button class="control-btn" id="toggleViewBtn" title="Show Chart">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </div>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-satellite-dish"></i>
                        </div>
                        <h3>AWAITING DATA TRANSMISSION</h3>
                        <p>Enter a query to begin analyzing your Azure logs</p>
                    </div>
                    
                    <div class="loading-state" id="loadingState" style="display: none;">
                        <div class="loader">
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                        </div>
                        <p>PROCESSING QUANTUM DATA...</p>
                    </div>

                    <div class="results-table-wrapper" id="resultsWrapper" style="display: none;">
                        <table class="results-table" id="resultsTable">
                            <thead id="tableHead"></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

                <!-- Data Sources Panel -->
                <section class="panel tables-panel" id="tablesPanel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <i class="fas fa-layer-group"></i>
                            <span>DATA SOURCES</span>
                        </div>
                        <div class="panel-controls">
                            <button class="control-btn" id="toggleTablesBtn" title="Minimize/Maximize">
                                <i class="fas fa-chevron-down" id="toggleTablesIcon"></i>
                            </button>
                            <button class="control-btn" id="refreshTablesBtn" title="Refresh">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <div class="tables-content" id="tablesContent">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="tableSearch" placeholder="Search tables...">
                        </div>

                        <div class="tables-list" id="tablesList">
                            <div class="loading-inline">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading tables...</span>
                            </div>
                        </div>

                        <!-- Schema Display -->
                        <div class="schema-section" id="schemaSection" style="display: none;">
                            <div class="schema-header">
                                <i class="fas fa-project-diagram"></i>
                                <span id="schemaTableName">TABLE SCHEMA</span>
                                <button class="close-btn" id="closeSchemaBtn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="schema-content" id="schemaContent"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Footer Stats -->
        <footer class="footer">
            <div class="stat-card">
                <i class="fas fa-server"></i>
                <div class="stat-info">
                    <span class="stat-value" id="workspaceId">---</span>
                    <span class="stat-label">WORKSPACE</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-robot"></i>
                <div class="stat-info">
                    <span class="stat-value" id="aiStatus">---</span>
                    <span class="stat-label">AI ENGINE</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <div class="stat-info">
                    <span class="stat-value" id="queryTime">0ms</span>
                    <span class="stat-label">LAST QUERY</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-line"></i>
                <div class="stat-info">
                    <span class="stat-value" id="totalQueries">0</span>
                    <span class="stat-label">QUERIES</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- AI Chat Modal -->
    <div class="chat-modal hidden" id="chatModal">
        <div class="chat-container">
            <div class="chat-header">
                <h3><i class="fas fa-robot"></i> AI LOG ASSISTANT</h3>
                <button class="close-chat-btn" id="closeChatBtn" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-context" id="chat-context-info">
                <em>No query results loaded. Run a query first for context-aware chat.</em>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Messages populated by JS -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Ask about your results...">
                <button class="send-chat-btn" id="sendChatBtn">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="/static/js/app.js"></script>
</body>
</html>
